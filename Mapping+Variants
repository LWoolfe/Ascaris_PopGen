# Analysis of population structure of Ascaris sp.  

## Table of contents
1. Project setup
2. Raw data
3. Mapping
4. Variants 
5. Quality Control 


## 01 - Project setup 
# Setup a working environment for the analysis.
mkdir Pop_gen
cd Pop_gen

# make working directories
mkdir 00_METADATA 01-reference 02-raw_sequences 03-mapping 04-variants 05-QC 06-analysis
```
## 02 - Raw Data
# Download publicly available WGS reads using SRA toolkit
# Trim and perform fastqc on all data 

fastp 
fast qc 
multiqc

# Download the A. suum reference genome on ncbi using SRA Toolkit 
cd 01-reference
prefetch GCA_013433145.1

# Validate the downloaded genome 
vdb-validate GCA_013433145.1

# Unzip
gunzip GCA_013433145.1_ASM1343314V1_genomic.fa.gz

#Ensure that GCA_013433145.1_ASM1343314v1_assembly_report.txt was downloaded, then create a list of primary scaffolds
#Check headers are correct
grep -v "^#" GCA_013433145.1_ASM1343314v1_assembly_report.txt | head
grep -v "^#" GCA_013433145.1_ASM1343314v1_assembly_report.txt \
  | awk -F '\t' '$2 == "assembled-molecule" && ($1 ~ /^chr[0-9]+$/ || $1 == "chrX") {print $5}' \
  > scaffolds_primary_plus_X.txt

# Exclude unmapped scaffolds (include only primary scaffolds)
seqtk subseq genome.fna scaffolds_primary_plus_X.txt > Ascaris_primary_scaffolds_plus_X.fasta

# Create indexes and a sequence dictionary for the reference genome
bwa index Ascaris_primary_scaffolds_plus_X.fasta
samtools faidx Ascaris_primary_scaffolds_plus_X.fasta
gatk CreateSequenceDictionary --REFERENCE Ascaris_primary_scaffolds_plus_X.fasta

# Check all primary scaffolds are present
grep -v "^#" GCA_013433145.1_ASM1343314v1_assembly_report.txt \
  | awk -F '\t' '$2 == "assembled-molecule" && $1 ~ /^chr[0-9]+$/ {print $1}' \
  | wc -l
wc -l scaffolds_primary.txt

conda activate gatk 
gatk CreateSequenceDictionary -R Ascaris_primary_scaffolds_plus_X.fa

## 03 - Mapping 
# Map sequence reads to reference genome

cd 03-mapping
conda activate BWA
chmod +x mapping.sh
./mapping.sh           

## Mark PCR duplicates
conda activate GATK
chmod +x Markdup.sh
./Markdup.sh    

chmod +x coverage_pipline.sh 


### 04 Variant Calling 
cd ../
./run_haplotypecaller.sh 
./genotyping.sh  
./run_SNP_select.sh
./run_INDEL_select.sh
./combine_VCF.sh
conda activate tools_env
./filter_VCF.sh










