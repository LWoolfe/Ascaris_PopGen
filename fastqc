#!/bin/bash
#SBATCH --job-name=fastqc
#SBATCH --cpus-per-task=8
#SBATCH --mem=100G
#SBATCH --time=48:00:00
#SBATCH --partition=shared
#SBATCH --output=fastqc_%j.out
#SBATCH --error=fastqc_%j.err

set -eo pipefail

# -----------------------------
# ENVIRONMENT
# -----------------------------
source /users/lw01165/miniconda3/etc/profile.d/conda.sh
conda activate fast_env
command -v fastqc >/dev/null || { echo "fastqc not found in PATH"; exit 1; }

# -----------------------------
# PATHS
# -----------------------------
INDIR="/parallel_scratch/lw01165/02_Samples/samples_fastp"   # adjust if it's samples_fastqc
OUTDIR="${INDIR}/fastqc_reports"
mkdir -p "$OUTDIR"

# -----------------------------
# RUN FASTQC
# -----------------------------
cd "$INDIR"

# Run FastQC on all fq/fq.gz in the folder (handles paired & single-end)
shopt -s nullglob
FILES=( *.fq.gz *.fastq.gz *.fq *.fastq )
if [[ ${#FILES[@]} -eq 0 ]]; then
  echo "No FASTQ files found in $INDIR"
  exit 0
fi

echo "Found ${#FILES[@]} files. Running FastQC..."
fastqc -t "${SLURM_CPUS_PER_TASK:-8}" -o "$OUTDIR" --noextract "${FILES[@]}"

echo "Done. Reports in: $OUTDIR"

